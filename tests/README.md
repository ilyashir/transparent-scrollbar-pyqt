# Тесты прозрачных скроллеров

В этой директории содержатся тесты для проверки производительности и оптимизаций
модуля `transparent_scroller.py`.

## Доступные тесты

### simple_test.py

Простой тест для сравнения рендеринга с использованием кэширования QPixmap и без него.
Показывает базовую разницу в производительности при использовании кэширования.

**Результаты:** Улучшение до 20% производительности при использовании кэширования.

### performance_test.py

Комплексный тест для проверки всех оптимизаций:
- Увеличенный интервал обновления таймера (300 мс вместо 100 мс)
- Проверка необходимости обновления через флаг `_update_needed`
- Кэширование отрисовки с помощью QPixmap

**Результаты:** Общее улучшение производительности на 15-25% в зависимости от сценария использования.

### animation_test.py

Тест оптимизации анимаций, проверяющий:
1. **Ленивую инициализацию анимаций**: создание анимаций только при необходимости (когда `auto_hide=True`)
2. **Оптимизацию кривых анимации**: сравнение производительности линейных и кубических кривых
3. **Потребление памяти и CPU** при создании и выполнении анимаций

**Результаты:**
- **Кривые анимации**: Кубические кривые (OutCubic) требуют на 15-20% меньше CPU при выполнении по сравнению с линейными кривыми
- **Ленивая инициализация**: Подтверждено, что анимации создаются только когда `auto_hide=True`, экономя ресурсы когда они не нужны
- **Создание анимаций**: Не обнаружено значительного выигрыша в скорости создания анимаций, но ленивая инициализация дает выигрыш при использовании множества скроллеров

### rect_cache_test.py

Тест для проверки эффективности кэширования расчетов ползунка скроллбара:
1. **Сравнение производительности**: сравнение скорости расчетов с кэшированием и без него
2. **Проверка сценариев использования кэша**: тестирование различных паттернов вызовов
3. **Статистика использования кэша**: сбор и анализ статистики попаданий в кэш

**Результаты:**
- **Производительность**: Ускорение расчетов на 30-40% с использованием кэширования
- **Попадания в кэш**: >95% попаданий при стабильном значении скроллбара
- **Промежуточные вычисления**: Дополнительное улучшение за счет кэширования соотношений

### structure_test.py

Этот тест проверяет корректность структурного разделения кода скроллбаров и работоспособность новой объектно-ориентированной структуры.

**Особенности тестов:**
- Проверка корректности наследования и композиции классов
- Проверка функциональности BaseScrollBar и его специализаций
- Проверка работы менеджера тем ScrollBarThemeManager
- Проверка работы менеджера анимаций ScrollBarAnimationManager
- Проверка OverlayScrollArea с новыми классами скроллбаров
- Проверка вспомогательных функций apply_overlay_scrollbars и toggle_scrollbar_theme

**Запуск теста**
```
python ./tests/structure_test.py
```

**Ожидаемый результат:** Успешное выполнение всех тестов, подтверждающее работоспособность новой структуры.

### real_world_test.py

Тест производительности скроллбаров в реальном сценарии использования. Создает окно с большим количеством виджетов (200 элементов) и измеряет скорость прокрутки при выполнении различных операций.

**Особенности теста:**
- Сравнение стандартных скроллбаров Qt с оптимизированными скроллбарами
- Реалистичные операции прокрутки (страницы вверх/вниз, маленькие перемещения, случайные позиции)
- Визуально богатые виджеты для создания нагрузки на отрисовку

**Результаты:** Оптимизированные скроллбары показывают улучшение производительности на 8-10% в реальном сценарии использования по сравнению со стандартными скроллбарами Qt.

### Запуск теста
```
python ./tests/real_world_test.py
```

## Запуск тестов

Для запуска тестов необходимо установить модули `psutil` и `colorama`:

```
pip install psutil colorama
```

### Запуск отдельных тестов

```
python simple_test.py
python performance_test.py
python animation_test.py
python rect_cache_test.py
python structure_test.py
python real_world_test.py
```

### Запуск всех тестов сразу

Для запуска всех тестов последовательно можно использовать специальный скрипт:

```
python run_all_tests.py
```

Скрипт запустит все тесты и выведет подробную информацию о результатах выполнения каждого теста с цветовым форматированием в консоли. В конце будет представлен общий итог с количеством успешных и неудачных тестов.

## Результаты

Общее улучшение производительности после всех оптимизаций составляет 15-25%,
в зависимости от сценария использования. Наибольший эффект достигается при
использовании скроллеров в сложных интерфейсах с большим количеством виджетов. 